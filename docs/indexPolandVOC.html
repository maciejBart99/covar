<!DOCTYPE html>
<html lang="pl">
<head>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Barlow:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700&display=swap" rel="stylesheet">  
    <script src="https://d3js.org/d3.v4.min.js"></script>    <link rel="stylesheet" href="styles.css">
    <meta charset="UTF-8">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="-1">
    <meta http-equiv="CACHE-CONTROL" content="NO-CACHE">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa RT-COVAR</title>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-5650686-7', 'biecek.pl');
  ga('send', 'pageview');

</script>
</head>
<body>
        <header>
            <div class="nav-container">
                <div class="header-block">
                    <h1>
                        Mapa RT<span class="text-orange">-</span>COVAR
                    </h1>
                    <h2>
                        monitor wariantów i mutacji SARS-COV-2
                    </h2>
                </div>
                <nav>
                    <div class="nav-block">
                        <h3 class="nav-block__title nav-block__title--bold">Warianty w Polsce
                            
                        </h3>
                        <ul class="nav-block__menu">
                            <li><a href="indexPolandVOC.html">VOC</a></li>
                            <li><a href="indexPolandWojewodztwa.html">Województwa</a></li>
                            <li><a href="indexPolandWiek.html">Wiek</a></li>
                            <li><a href="indexPolandMutacje.html">Mutacje</a></li>
                        </ul>
                    </div>
                    <div class="nav-block">
                        <h3 class="nav-block__title nav-block__title--bold">Warianty w Europie
                            
                        </h3>
                        <ul class="nav-block__menu">
                            <li><a href="indexEuropeVOHC.html">VOHC</a></li>
                            <li><a href="indexEuropeVOC.html">VOC</a></li>
                            <li><a href="indexEuropeVOI.html">VOI</a></li>
                            <li><a href="indexEuropeVUM.html">VUM</a></li>
                        </ul>
                    </div>
                    <div class="nav-block">
                        <h3 class="nav-block__title nav-block__title--bold">Specjlistyczne raporty</h3>
                        <ul class="nav-block__menu">
                            <li><a href="indexKoinf.html">Koinfekcje</a></li>
                            <li><a href="indexWykryc.html">Wykrycia zagraniczne</a></li>
                        </ul>
                    </div>
                    <div class="nav-block">
                        <h3 class="nav-block__title nav-block__title--bold"><a>O Mapie</a></h3>
                    </div>
                </nav>
            </div>
        </header>
        <main>
            <div class="main-container">
                <div class="map-view__header">
                    <div class="map-view__title-section">
                        <h2 class="map-view__title">Monitoring wariantów SARS-COV-2 w Polsce</h2>
                    </div>
                    <div class="map-view__scale">
                        <span class="map-view__scale-text">skala:</span>
                        <span class="map-view__scale-circle--big">250
                            <span class="map-view__scale-circle--small">50</span>
                        </span>
                    </div>
                </div>
                <div class="map-view__content">
                    <div class="map-view__filters">
                        <h4 class="map-view__filters-title">W minionym miesiącu zarejestrowano</h4>
                        <div class="info-panels__group">
                            <div class="info-panels__pane">
                                <h4 id="wild" class="info-panels__main --yellow">-</h4>
                                <p class="info-panels__subtitle">przypadków wariantów <span class="--yellow">dzikich</span></p>
                            </div>
                            <div class="info-panels__pane">
                                <h4 id="alert" class="info-panels__main --orange">-</h4>
                                <p class="info-panels__subtitle">przypadków wariantów <span class="--orange">alertowych</span></p>
                            </div>
                            <div class="info-panels__pane">
                                <h4 id="special" class="info-panels__main --purple">-</h4>
                                <p class="info-panels__subtitle">przypadków wariantów <span class="--purple">szczególnego nadzoru</span></p>
                            </div>
                        </div>
                        <div class="filter-block">
                            <div class="filter-block__title-section">
                                <h5 class="filter-block__title">Warianty
                                    <div class="help-mark">
                                        i
                                        <div class="help-mark__popup">
                                            Help help help
                                        </div>
                                    </div>
                                </h5>
                                <ul class="filter-block__list">
                                    <li>
                                        <label class="custom-checkbox">Brytyjski
                                            <input type="checkbox" checked onchange="filtersHandle('Brytyjski')">
                                            <span class="custom-checkbox__checkmark"></span>
                                        </label>
                                    </li>
                                    <li>
                                        <label class="custom-checkbox">Południowoafrykański
                                            <input type="checkbox" checked onchange="filtersHandle('Afrykanski')">
                                            <span class="custom-checkbox__checkmark"></span>
                                        </label>
                                    </li>
                                    <li>
                                        <label class="custom-checkbox">Indyjski
                                            <input type="checkbox" checked onchange="filtersHandle('Indyjski')">
                                            <span class="custom-checkbox__checkmark"></span>
                                        </label>
                                    </li>
                                    <li>
                                        <label class="custom-checkbox">Dziki
                                            <input type="checkbox" checked onchange="filtersHandle('Dziki')">
                                            <span class="custom-checkbox__checkmark"></span>
                                        </label>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="map-view__map" style="padding-left:50px; padding-top: 50px">
                    <div style="background-image: url('images/mapa.svg'); background-repeat: no-repeat; padding:0px">
                        <svg width="655" height="610" id = "mapa-covar"></svg>
                    </div>
                    </div>
                </div>
            </div>
            <div class="map-view__footer">
                <h4 class="map-view__footer-title">
                    Zmiana sytuacji w czasie<div class="help-mark">
                        i
                        <div class="help-mark__popup">
                            Help help help
                        </div>
                    </div>
                </h4>
                <div class="timeline">
                    <div id="slider" class="timeline__line">
                        <div class="timeline__marker">

                        </div>
                        <span class=timline__date>
                            15 maja
                        </span>
                    </div>
                </div>
                <h4 class="map-view__footer-title" style="background: #ffffff">
                    <center><img width="800px" src="images/logo.png"></center>
                </h4>
            </div>
        </main>
</body>

<script src="data/data.js"></script>
<script src="scripts/slider.js"></script>
<script>

slider('slider', ['10 maja', '11 maja', '12 maja', '13 maja', '14 maja', '15 maja', '16 maja', '17 maja', '17 maja']);

let acitveFilters = ['Brytyjski', 'Afrykanski', 'Indyjski', 'Dziki'];
const colorMap = {
    Brytyjski: '#ff8f57',
    Afrykanski: '#b00064',
    Indyjski: '#b00064',
    Dziki: '#ffca38'
};

const scaleSzerokosc = d3.scaleLinear()
            .domain([49.10, 54.83])
            .range([610, 0]);

const scaleDlugosc = d3.scaleLinear()
            .domain([14.07, 24.09])
            .range([0, 655]);

const scaleSize = d3.scaleSqrt()
            .domain([1, 200])
            .range([2, 30]);

const divTooltip = d3.select("body").append("div")
    .attr("class", "tooltipMap")
    .style("opacity", 0);

const divTooltip2 = d3.select("body").append("div")
    .attr("class", "tooltipMap")
    .style("opacity", 0);

const svg = d3.select("#mapa-covar");

function filtersHandle(filterName) {
    if (acitveFilters.indexOf(filterName) === -1) {
        acitveFilters = [...acitveFilters, filterName];
    } else {
        acitveFilters = acitveFilters.filter(name => name !== filterName);
    }
    reload();
}

async function reload() {
    const data = await getData();
    d3.select('#wild').text(data.summary.wild);
    d3.select('#alert').text(data.summary.alert);
    d3.select('#special').text(data.summary.special);
    svg.selectAll('*').remove();
    acitveFilters.forEach(name => {
        const svgg = svg.append("g");
        svgg.selectAll("circle")
        .data(data.mapData)
        .enter()
        .append("circle")
        .attr("cx", function(d) {
            return (scaleDlugosc(d.StacjaDlugosc));
        })
        .attr("cy", function(d) {
            return (scaleSzerokosc(d.StacjaSzerokosc));
        })
        .attr("r", function(d) {
            return (scaleSize(d[name]));
        })
        .attr("fill", colorMap[name] + '50')
        .attr("opacity", 0.7)
        .attr("stroke", colorMap[name])
        .on("mouseover", function(d) {      
            divTooltip.transition()        
                .duration(200)      
                .style("opacity", .9);      
            divTooltip.html('<svg> <rect class="cls-3" x="15" y="0" width="142.84" height="91.73"/><rect class="cls-3" x="25" y="0" width="11.38" height="11.38" transform="rotate(45)"/> <text class="cls-27"  transform="translate(25 15)">'+d.Stacja+'<tspan x="0" y="17.8">B.1.1.7. (brytyjski): </tspan><tspan class="cls-6" > ' + d.Brytyjski +'</tspan><tspan x="0" y="35.6">B.1.617.2. (indyjski): </tspan><tspan class="cls-36" >' + d.Indyjski +'</tspan><tspan x="0" y="53.4">B.1.351 (afrykański): </tspan><tspan class="cls-36" >' + d.Afrykanski +'</tspan><tspan x="0" y="70.4">Inne: </tspan><tspan class="cls-8">' + d.Dziki +'</tspan></text></svg>')  
                .style("left", (d3.event.pageX) + "px")     
                .style("top", (d3.event.pageY - 28) + "px");    
            })                  
        .on("mouseout", function(d) {       
            divTooltip.transition()        
                .duration(500)      
                .style("opacity", 0);   
        });
    });
}

reload();

</script>
</html>
